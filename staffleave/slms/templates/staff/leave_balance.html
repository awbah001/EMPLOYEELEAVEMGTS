{% extends 'base.html' %}
{% load static %}

{% block title %}Leave Balance - HarmonyLeave (E/SLMS){% endblock %}

{% block content %}
<!-- Page Header -->
<div class="modern-card" style="background: var(--gradient-primary); color: var(--white); margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="material-icons" style="font-size: 2rem;">account_balance_wallet</i>
            </div>
            <div>
                <h2 style="margin: 0; font-size: 1.75rem; font-weight: 600;">Leave Balance</h2>
                <p style="margin: 0.25rem 0 0 0; opacity: 0.9; font-size: 0.875rem;">View your available leave days for {{ current_year }}</p>
            </div>
        </div>
        <a href="{% url 'staff_home' %}" style="color: var(--white); text-decoration: none; display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); transition: background 0.2s ease;">
            <i class="material-icons" style="font-size: 1.25rem;">arrow_back</i>
            Back
        </a>
    </div>
</div>

<!-- Year Selector -->
<div class="modern-card" style="margin-bottom: 2rem;">
    <form method="GET" action="{% url 'staff_leave_balance' %}" style="display: flex; gap: 1rem; align-items: flex-end;">
        <div class="form-group" style="flex: 1;">
            <label for="year" style="display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 0.5rem;">Select Year</label>
            <select id="year" name="year" class="form-input" style="width: 100%; padding: 0.75rem; border: 2px solid var(--medium-gray); border-radius: var(--radius-md); font-size: 1rem;" onchange="this.form.submit()">
                <option value="2020" {% if current_year == 2020 %}selected{% endif %}>2020</option>
                <option value="2021" {% if current_year == 2021 %}selected{% endif %}>2021</option>
                <option value="2022" {% if current_year == 2022 %}selected{% endif %}>2022</option>
                <option value="2023" {% if current_year == 2023 %}selected{% endif %}>2023</option>
                <option value="2024" {% if current_year == 2024 %}selected{% endif %}>2024</option>
                <option value="2025" {% if current_year == 2025 %}selected{% endif %}>2025</option>
                <option value="2026" {% if current_year == 2026 %}selected{% endif %}>2026</option>
                <option value="2027" {% if current_year == 2027 %}selected{% endif %}>2027</option>
                <option value="2028" {% if current_year == 2028 %}selected{% endif %}>2028</option>
                <option value="2029" {% if current_year == 2029 %}selected{% endif %}>2029</option>
                <option value="2030" {% if current_year == 2030 %}selected{% endif %}>2030</option>
            </select>
        </div>
    </form>
</div>

<!-- Leave Balances -->
{% if leave_balances %}
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        {% for balance in leave_balances %}
        <div class="modern-card" style="position: relative; overflow: hidden;">
            <!-- Background decoration -->
            <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: {% if balance.days_remaining > 0 %}rgba(16, 185, 129, 0.1){% else %}rgba(239, 68, 68, 0.1){% endif %}; border-radius: 50%;"></div>
            
            <div style="position: relative; z-index: 1;">
                <!-- Leave Type Header -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 50px; height: 50px; background: {% if balance.days_remaining > 0 %}rgba(16, 185, 129, 0.1){% else %}rgba(239, 68, 68, 0.1){% endif %}; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="material-icons" style="color: {% if balance.days_remaining > 0 %}#10b981{% else %}#ef4444{% endif %}; font-size: 1.5rem;">event_available</i>
                        </div>
                        <div>
                            <h3 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: var(--text-primary);">{{ balance.leave_type.name }}</h3>
                            <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">{{ current_year }}</p>
                        </div>
                    </div>
                </div>
                
                <!-- Days Remaining (Large Display) -->
                <div style="text-align: center; padding: 1.5rem; background: {% if balance.days_remaining > 0 %}rgba(16, 185, 129, 0.05){% else %}rgba(239, 68, 68, 0.05){% endif %}; border-radius: var(--radius-lg); margin-bottom: 1.5rem;">
                    <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Days Remaining</div>
                    <div style="font-size: 3rem; font-weight: 700; color: {% if balance.days_remaining > 0 %}#10b981{% else %}#ef4444{% endif %}; line-height: 1;">
                        {{ balance.days_remaining }}
                    </div>
                </div>
                
                <!-- Breakdown -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding-top: 1rem; border-top: 1px solid var(--medium-gray);">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Entitled</div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary);">{{ balance.days_entitled }}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Used</div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--text-primary);">{{ balance.days_used }}</div>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div style="margin-top: 1rem;">
                    <div style="width: 100%; height: 8px; background: var(--light-gray); border-radius: 4px; overflow: hidden;">
                        {% if balance.days_entitled > 0 %}
                            {% widthratio balance.days_used balance.days_entitled 100 as usage_percent %}
                            <div style="width: {{ usage_percent }}%; height: 100%; background: {% if balance.days_remaining > 0 %}linear-gradient(90deg, #10b981 0%, #047857 100%){% else %}linear-gradient(90deg, #ef4444 0%, #dc2626 100%){% endif %}; transition: width 0.3s ease;"></div>
                        {% else %}
                            <div style="width: 0%; height: 100%; background: var(--medium-gray);"></div>
                        {% endif %}
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">
                        <span>{{ balance.days_used }} of {{ balance.days_entitled }} days used</span>
                        {% if balance.days_entitled > 0 %}
                            <span>{{ usage_percent }}%</span>
                        {% else %}
                            <span>0%</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Summary Card -->
    <div class="modern-card" style="background: var(--gradient-primary); color: var(--white);">
        <h3 style="margin: 0 0 1.5rem 0; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
            <i class="material-icons">assessment</i>
            Summary for {{ current_year }}
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
            <div>
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Total Entitled</div>
                <div style="font-size: 2rem; font-weight: 700; line-height: 1;" id="total-entitled">{{ total_entitled|default:0 }}</div>
            </div>
            <div>
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Total Used</div>
                <div style="font-size: 2rem; font-weight: 700; line-height: 1;" id="total-used">{{ total_used|default:0 }}</div>
            </div>
            <div>
                <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">Total Remaining</div>
                <div style="font-size: 2rem; font-weight: 700; line-height: 1;" id="total-remaining">{{ total_remaining|default:0 }}</div>
            </div>
        </div>
    </div>
{% else %}
    <!-- Empty State -->
    <div class="modern-card" style="text-align: center; padding: 3rem;">
        <div style="width: 100px; height: 100px; background: var(--light-gray); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
            <i class="material-icons" style="font-size: 3rem; color: var(--text-secondary);">account_balance_wallet</i>
        </div>
        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 600; color: var(--text-primary);">No Leave Balance Found</h3>
        <p style="margin: 0 0 1.5rem 0; color: var(--text-secondary);">Your leave entitlements for {{ current_year }} have not been set up yet.</p>
        <p style="margin: 0; font-size: 0.875rem; color: var(--text-secondary);">Please contact HR to set up your leave entitlements.</p>
    </div>
{% endif %}

<!-- Quick Actions -->
<div class="modern-card" style="margin-top: 2rem;">
    <h3 style="margin: 0 0 1rem 0; font-size: 1.125rem; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: 0.5rem;">
        <i class="material-icons" style="color: var(--primary-blue);">flash_on</i>
        Quick Actions
    </h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{% url 'staff_apply_leave' %}" class="btn-primary" style="padding: 0.75rem 1.5rem; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
            <i class="material-icons" style="font-size: 1rem;">add_circle</i>
            Apply for Leave
        </a>
        <a href="{% url 'staff_leave_view' %}" class="btn-secondary" style="padding: 0.75rem 1.5rem; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
            <i class="material-icons" style="font-size: 1rem;">history</i>
            View Leave History
        </a>
    </div>
</div>

<style>
/* Card hover effect */
.modern-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-large);
    transition: all 0.3s ease;
}

/* Responsive grid */
@media (max-width: 768px) {
    div[style*="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr))"] {
        grid-template-columns: 1fr !important;
    }
    
    div[style*="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr))"] {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate numbers on load
    const numberElements = document.querySelectorAll('[style*="font-size: 3rem"]');
    numberElements.forEach(element => {
        const target = parseInt(element.textContent.trim());
        if (target >= 0 && !isNaN(target)) {
            let current = 0;
            const increment = Math.max(1, target / 30);
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 50);
        }
    });
    
    // Animate summary numbers
    const summaryNumbers = document.querySelectorAll('#total-entitled, #total-used, #total-remaining');
    summaryNumbers.forEach(element => {
        const target = parseInt(element.textContent.trim());
        if (target >= 0 && !isNaN(target)) {
            let current = 0;
            const increment = Math.max(1, target / 20);
            const originalText = element.textContent;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = originalText;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 50);
        }
    });
});
</script>
{% endblock %}

