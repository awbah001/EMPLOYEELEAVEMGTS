{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Staff - Admin Dashboard{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="modern-card" style="background: var(--gradient-primary); color: var(--white); margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="material-icons" style="font-size: 1.5rem;">group</i>
            </div>
            <div>
                <h2 style="margin: 0; font-size: 1.5rem; font-weight: 600;">Manage Staff</h2>
                <p style="margin: 0; opacity: 0.9; font-size: 0.95rem;">View and manage all staff members</p>
            </div>
        </div>
        <a href="{% url 'add_staff' %}" class="btn-secondary" style="background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.3); color: var(--white); width: auto; padding: 0.75rem 1rem;">
            <i class="material-icons" style="font-size: 1rem; margin-right: 0.5rem;">person_add</i>
            Add New Staff
        </a>
    </div>
</div>

<!-- Messages -->
{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'error' %}
            <div class="alert alert-error" style="margin-bottom: 1.5rem;">
                <i class="material-icons" style="font-size: 16px; margin-right: 8px;">error_outline</i>
                {{message}}
            </div>
        {% elif message.tags == 'success' %}
            <div class="alert alert-success" style="margin-bottom: 1.5rem;">
                <i class="material-icons" style="font-size: 16px; margin-right: 8px;">check_circle</i>
                {{message}}
            </div>
        {% endif %}
    {% endfor %}
{% endif %}

<!-- Staff Table -->
<div class="modern-card">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
        <h3 style="margin: 0; display: flex; align-items: center; gap: 0.5rem;">
            <i class="material-icons" style="color: var(--primary-blue);">people</i>
            Staff Directory
        </h3>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                Total: <strong>{{staff.count}}</strong> staff members
            </div>
        </div>
    </div>
    
    {% if staff %}
        <div class="table-container" style="overflow-x: auto; border-radius: var(--radius-lg); border: 1px solid var(--medium-gray);">
            <table class="modern-table" id="table_id">
                <thead>
                    <tr>
                        <th style="width: 60px;">ID</th>
                        <th style="width: 80px;">Photo</th>
                        <th>Name</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th style="width: 100px;">Gender</th>
                        <th style="width: 130px;">Join Date</th>
                        <th style="width: 120px;">Actions</th>
                    </tr>
                </thead>
                
                <tbody>
                    {% for staff_member in staff %}
                    <tr>
                        <td style="font-weight: 600; color: var(--primary-blue);">#{{staff_member.id}}</td>
                        <td>
                            <div style="width: 50px; height: 50px; border-radius: 50%; overflow: hidden; border: 2px solid var(--medium-gray);">
                                <img src="/{{staff_member.admin.profile_pic}}" alt="{{staff_member.admin.first_name}}" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                        </td>
                        <td>
                            <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <span style="font-weight: 600; color: var(--text-primary);">{{staff_member.admin.first_name}} {{staff_member.admin.last_name}}</span>
                            </div>
                        </td>
                        <td style="color: var(--text-secondary); font-family: monospace;">@{{staff_member.admin.username}}</td>
                        <td>
                            <a href="mailto:{{staff_member.admin.email}}" style="color: var(--primary-blue); text-decoration: none; display: flex; align-items: center; gap: 0.25rem;">
                                <i class="material-icons" style="font-size: 1rem;">email</i>
                                {{staff_member.admin.email}}
                            </a>
                        </td>
                        <td>
                            <span class="status-badge" style="background: rgba(45, 90, 160, 0.1); color: var(--primary-blue);">
                                {{staff_member.gender}}
                            </span>
                        </td>
                        <td style="color: var(--text-secondary);">
                            {{staff_member.created_at|date:"M d, Y"}}
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{% url 'edit_staff' staff_member.id %}" 
                                   style="display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; background: rgba(16, 185, 129, 0.1); color: #10b981; border-radius: 50%; text-decoration: none; transition: all 0.2s ease;"
                                   title="Edit Staff">
                                    <i class="material-icons" style="font-size: 1rem;">edit</i>
                                </a>
                                <a href="{% url 'delete_staff' staff_member.admin.id %}" 
                                   style="display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; background: rgba(239, 68, 68, 0.1); color: #ef4444; border-radius: 50%; text-decoration: none; transition: all 0.2s ease;"
                                   title="Delete Staff"
                                   onclick="return confirm('Are you sure you want to delete this staff member? This action cannot be undone.')">
                                    <i class="material-icons" style="font-size: 1rem;">delete</i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <!-- Empty State -->
        <div style="text-align: center; padding: 3rem 1rem;">
            <div style="width: 80px; height: 80px; background: var(--light-gray); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                <i class="material-icons" style="font-size: 2rem; color: var(--text-secondary);">people_outline</i>
            </div>
            <h4 style="margin-bottom: 0.5rem; color: var(--text-primary);">No Staff Members Found</h4>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Get started by adding your first staff member to the system.</p>
            <a href="{% url 'add_staff' %}" class="btn-primary" style="width: auto; padding: 0.75rem 1.5rem;">
                <i class="material-icons" style="font-size: 1rem; margin-right: 0.5rem;">person_add</i>
                Add First Staff Member
            </a>
        </div>
    {% endif %}
</div>

<!-- Additional Styles -->
<style>
/* Action button hover effects */
.modern-table a[href*="edit"]:hover {
    background: rgba(16, 185, 129, 0.2) !important;
    transform: scale(1.1);
}

.modern-table a[href*="delete"]:hover {
    background: rgba(239, 68, 68, 0.2) !important;
    transform: scale(1.1);
}

/* Enhanced table responsiveness */
@media (max-width: 1024px) {
    .modern-table th:nth-child(4),
    .modern-table td:nth-child(4) {
        display: none;
    }
}

@media (max-width: 768px) {
    .modern-table th:nth-child(6),
    .modern-table td:nth-child(6),
    .modern-table th:nth-child(7),
    .modern-table td:nth-child(7) {
        display: none;
    }
    
    .modern-card h2 {
        font-size: 1.25rem;
    }
    
    div[style*="justify-content: space-between"] {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
}

/* DataTable custom styling */
.dataTables_wrapper .dataTables_length,
.dataTables_wrapper .dataTables_filter,
.dataTables_wrapper .dataTables_info,
.dataTables_wrapper .dataTables_paginate {
    color: var(--text-secondary);
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
    background: var(--white);
    border: 1px solid var(--medium-gray);
    color: var(--text-primary);
    border-radius: var(--radius-sm);
    margin: 0 2px;
}

.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background: var(--primary-blue);
    color: var(--white);
    border-color: var(--primary-blue);
}

.dataTables_wrapper .dataTables_paginate .paginate_button.current {
    background: var(--primary-blue);
    color: var(--white);
    border-color: var(--primary-blue);
}
</style>

<!-- Enhanced JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize DataTable with custom configuration
    if ($.fn.DataTable) {
        $('#table_id').DataTable({
            "pageLength": 10,
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "order": [[0, "asc"]],
            "columnDefs": [
                { "orderable": false, "targets": [1, 7] }, // Disable sorting for photo and actions columns
                { "searchable": false, "targets": [1, 7] }  // Disable searching for photo and actions columns
            ],
            "language": {
                "search": "Search staff:",
                "lengthMenu": "Show _MENU_ staff members",
                "info": "Showing _START_ to _END_ of _TOTAL_ staff members",
                "infoEmpty": "No staff members found",
                "infoFiltered": "(filtered from _MAX_ total staff members)",
                "zeroRecords": "No matching staff members found",
                "paginate": {
                    "first": "First",
                    "last": "Last",
                    "next": "Next",
                    "previous": "Previous"
                }
            },
            "responsive": true
        });
    }
    
    // Add confirmation for delete actions
    document.querySelectorAll('a[href*="delete_staff"]').forEach(link => {
        link.addEventListener('click', function(e) {
            const staffName = this.closest('tr').querySelector('td:nth-child(3) span').textContent;
            if (!confirm(`Are you sure you want to delete ${staffName}? This action cannot be undone.`)) {
                e.preventDefault();
            }
        });
    });
    
    // Add loading states for action buttons
    document.querySelectorAll('a[href*="edit_staff"], a[href*="delete_staff"]').forEach(link => {
        link.addEventListener('click', function() {
            this.style.opacity = '0.6';
            this.style.pointerEvents = 'none';
        });
    });
});
</script>
{% endblock %}