{% extends 'base.html' %}
{% load static %}

{% block title %}Leave Calendar - HR Dashboard{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="modern-card" style="background: var(--gradient-primary); color: var(--white); margin-bottom: 2rem;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="material-icons" style="font-size: 2rem;">calendar_today</i>
            </div>
            <div>
                <h2 style="margin: 0; font-size: 1.75rem; font-weight: 600;">Leave Calendar</h2>
                <p style="margin: 0.25rem 0 0 0; opacity: 0.9; font-size: 0.875rem;">View all approved leaves across the organization</p>
            </div>
        </div>
        <a href="{% url 'hr_home' %}" style="color: var(--white); text-decoration: none; display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); transition: background 0.2s ease;">
            <i class="material-icons" style="font-size: 1.25rem;">arrow_back</i>
            Back
        </a>
    </div>
</div>

<!-- Month Navigation -->
<div class="modern-card" style="margin-bottom: 2rem;">
    <form method="GET" action="{% url 'hr_calendar' %}" style="display: flex; gap: 1rem; align-items: center; justify-content: center;">
        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
            <label for="month" style="font-weight: 500; color: var(--text-primary);">Month:</label>
            <select id="month" name="month" class="form-input" style="width: 150px; padding: 0.75rem; border: 2px solid var(--medium-gray); border-radius: var(--radius-md); font-size: 1rem;">
                <option value="1" {% if current_month == 1 %}selected{% endif %}>January</option>
                <option value="2" {% if current_month == 2 %}selected{% endif %}>February</option>
                <option value="3" {% if current_month == 3 %}selected{% endif %}>March</option>
                <option value="4" {% if current_month == 4 %}selected{% endif %}>April</option>
                <option value="5" {% if current_month == 5 %}selected{% endif %}>May</option>
                <option value="6" {% if current_month == 6 %}selected{% endif %}>June</option>
                <option value="7" {% if current_month == 7 %}selected{% endif %}>July</option>
                <option value="8" {% if current_month == 8 %}selected{% endif %}>August</option>
                <option value="9" {% if current_month == 9 %}selected{% endif %}>September</option>
                <option value="10" {% if current_month == 10 %}selected{% endif %}>October</option>
                <option value="11" {% if current_month == 11 %}selected{% endif %}>November</option>
                <option value="12" {% if current_month == 12 %}selected{% endif %}>December</option>
            </select>
            
            <label for="year" style="font-weight: 500; color: var(--text-primary);">Year:</label>
            <select id="year" name="year" class="form-input" style="width: 120px; padding: 0.75rem; border: 2px solid var(--medium-gray); border-radius: var(--radius-md); font-size: 1rem;">
                <option value="2023" {% if current_year == 2023 %}selected{% endif %}>2023</option>
                <option value="2024" {% if current_year == 2024 %}selected{% endif %}>2024</option>
                <option value="2025" {% if current_year == 2025 %}selected{% endif %}>2025</option>
                <option value="2026" {% if current_year == 2026 %}selected{% endif %}>2026</option>
                <option value="2027" {% if current_year == 2027 %}selected{% endif %}>2027</option>
            </select>
            
            <button type="submit" class="btn-primary" style="padding: 0.75rem 1.5rem;">
                <i class="material-icons" style="font-size: 1rem; margin-right: 0.5rem;">search</i>
                View
            </button>
        </div>
    </form>
</div>

<!-- Calendar View -->
<div class="modern-card">
    <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
        <i class="material-icons" style="color: var(--primary-blue);">event</i>
        Approved Leaves for 
        {% if current_month == 1 %}January{% elif current_month == 2 %}February{% elif current_month == 3 %}March{% elif current_month == 4 %}April{% elif current_month == 5 %}May{% elif current_month == 6 %}June{% elif current_month == 7 %}July{% elif current_month == 8 %}August{% elif current_month == 9 %}September{% elif current_month == 10 %}October{% elif current_month == 11 %}November{% else %}December{% endif %} {{ current_year }}
    </h3>
    
    {% if approved_leaves %}
        <div class="table-container" style="overflow-x: auto; border-radius: var(--radius-lg); border: 1px solid var(--medium-gray);">
            <table class="modern-table" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: var(--light-gray);">
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">Staff Name</th>
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">Department</th>
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">Leave Type</th>
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">From Date</th>
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">To Date</th>
                        <th style="padding: 1rem; font-weight: 600; color: var(--text-primary); text-align: left;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in approved_leaves %}
                    <tr>
                        <td style="padding: 1rem; font-weight: 600; color: var(--text-primary);">{{ leave.staff_id.admin.get_full_name }}</td>
                        <td style="padding: 1rem; color: var(--text-secondary);">{{ leave.staff_id.department.name|default:"N/A" }}</td>
                        <td style="padding: 1rem; color: var(--text-secondary);">{{ leave.leave_type_name|default:leave.leave_type.name|default:"N/A" }}</td>
                        <td style="padding: 1rem; color: var(--text-secondary);">{{ leave.from_date|date:"M d, Y" }}</td>
                        <td style="padding: 1rem; color: var(--text-secondary);">{{ leave.to_date|date:"M d, Y" }}</td>
                        <td style="padding: 1rem;">
                            <span class="status-badge" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">Approved</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <i class="material-icons" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">calendar_today</i>
            <p style="font-size: 1.125rem; margin-bottom: 0.5rem;">No approved leaves for this month</p>
            <p style="font-size: 0.875rem; opacity: 0.7;">There are no approved leave applications for the selected month</p>
        </div>
    {% endif %}
    
    {% if public_holidays %}
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--medium-gray);">
            <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="material-icons" style="color: #f59e0b;">celebration</i>
                Public Holidays
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                {% for holiday in public_holidays %}
                    <div style="padding: 1rem; background: rgba(249, 115, 22, 0.05); border: 1px solid rgba(249, 115, 22, 0.1); border-radius: var(--radius-md);">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">{{ holiday.name }}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">{{ holiday.date|date:"M d, Y" }}</div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>

<style>
.modern-table tr:hover {
    background: rgba(45, 90, 160, 0.02) !important;
}
</style>
{% endblock %}

